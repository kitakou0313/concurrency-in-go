# Goにおける並行処理の構成要素

# Goroutine
- Goroutine
    - 他のコードに対し，並行に実行している関数のこと
- 背景で実行されている処理
    - コルーチンとして知られる，高水準の抽象化
        - コルーチン = プリエンティブ（割り込みされない）ではない並行処理の関数，クロージャ，メソッドに対応
        - 割り込み不可の代わりに一時停止可能なポイントや再エントリ可能な複数のポイントがある
    - M:NスケジューラーというモデルでGoroutineのホストを行っている
    - Goではjoin-forkモデルという並行処理のモデルに従っている
        - 任意の場所で分岐し，その先で再び合流するモデル
    - 明示的にJoinする処理を実装しなければ，GoroutineがスケジュールされることなくメインのGoroutineが完了してしまう可能場合がある
- クロージャとGoroutine
    - クロージャ
        - 関数とその関数が定義された環境（スコープ）の組み合わせ
        - 関数定義時にその関数が参照している外側の関数の状態を後からでも保持して利用できる仕組み
    - goroutineでクロージャを実行した場合，それが作られたアドレス空間で実行する
        - クロージャはそれ自身が定義された環境と同じスコープで動作する
- Goroutineは互いに同じアドレス空間を操作している
    - forループ内で用いた変数をgoroutine内で参照すると，ループの最後の値のみ参照することになる
- Goroutineの軽量さ
    - メモリ使用量の視点
        - Goroutine一つにつき数kb
        - Goroutineがブロックされ続ける限り，GCによって回収されない点に注意
            - Goroutine leak
    - コンテキストスイッチの視点
        - OSのコンテキストスイッチの1/20程度


# syncパッケージ
- 低水準のメモリアクセス同期のためのプリミティブ
- Goに特有の点
    - メモリアクセス同期のプリミティブの上にチャンネルというプリミティブを導入している
- 用途
    - structのような小さいスコープ
    - 低水準のライブラリのため
        - 高水準の処理ではチャンネルを使用する
            - （通信によってメモリを共有し，メモリの共有によって通信してはいけない）

## waitGroup
- ひとまとまりの並行処理があった場合，それらの結果に依らず完了を待つ手段
    - 結果を確認したい場合は`select`文が良い
